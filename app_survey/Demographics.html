{% extends "global/Page.html" %}
{% block title %}Demographics{% endblock %}

{% block content %}
<style>
    .question-card {
        background: #fff;
        border: 1px solid #e3e6f0;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.05);
    }
    .question-label {
        font-weight: 600;
        font-size: 1.05rem;
        color: #2c3e50;
        margin-bottom: 10px;
        display: block;
    }
    .text-muted { font-size: 0.9rem; margin-bottom: 10px; display: block; }
    
    /* 调整多选框的样式 */
    .form-check { margin-bottom: 8px; }
    
    /* 隐藏区域样式 */
    #conditional-section {
        display: none; /* 默认隐藏 */
        background-color: #f8f9fa;
        border-left: 5px solid #007bff;
        padding: 20px;
        margin-top: 30px;
        border-radius: 5px;
    }
    
    .matrix-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 0;
        border-bottom: 1px solid #eee;
    }
    .matrix-label { width: 40%; font-size: 0.95rem; }
    .matrix-options { width: 55%; display: flex; justify-content: space-between; }
    
    .legend-bar {
        background: #eef2f7;
        padding: 5px;
        border-radius: 4px;
        margin-bottom: 15px;
        font-size: 0.8rem;
        color: #555;
        display: flex;
        justify-content: space-between;
        text-align: center;
    }
</style>

<p class="lead">
    For the final part of the study, we would like to collect some basic demographic information for statistical analysis.
    All of your responses will be kept strictly confidential and anonymized.
</p>

<div class="question-card">{{ formfield 'age' }}</div>
<div class="question-card">{{ formfield 'gender' }}</div>
<div class="question-card">{{ formfield 'nationality' }}</div>
<div class="question-card">{{ formfield 'race' }}</div>
<div class="question-card">{{ formfield 'education' }}</div>
<div class="question-card">{{ formfield 'field_of_study' }}</div>
<div class="question-card">{{ formfield 'income' }}</div>
<div class="question-card">{{ formfield 'religion' }}</div>
<div class="question-card">{{ formfield 'marital_status' }}</div>
<div class="question-card">{{ formfield 'ai_use_freq' }}</div>
<div class="question-card">{{ formfield 'ai_attitude' }}</div>

<div class="question-card" id="q_ai_companion">
    {{ formfield 'ai_companion' }}
</div>

<div class="question-card" id="q_ai_general">
    {{ formfield 'ai_general_personal' }}
</div>

<div id="conditional-section">
    <h5 class="mb-3">Detailed AI Usage</h5>
    
    <div class="question-card">
        <label class="question-label">{{ form.ai_personal_pct.label }}</label>
        <span class="text-muted">(Please exclude functional tasks like writing code, drafting emails, or searching for information. Focus only on the time spent on personal conversation.)</span>
        <div class="input-group" style="max-width: 200px;">
            {{ form.ai_personal_pct }}
            <div class="input-group-append">
                <span class="input-group-text">%</span>
            </div>
        </div>
    </div>

    <div class="question-card">
        <label class="question-label">When you use AI for personal topics, how frequently do you discuss each of the following issues?</label>
        <span class="text-muted">Please rate on a scale of 1 to 7, where <b>1 = Never</b> and <b>7 = Very Frequently</b>.</span>
        
        <div class="legend-bar">
            <div style="width:14%">1<br>Never</div>
            <div style="width:14%">2</div>
            <div style="width:14%">3</div>
            <div style="width:14%">4</div>
            <div style="width:14%">5</div>
            <div style="width:14%">6</div>
            <div style="width:14%">7<br>Freq</div>
        </div>
        
        <div class="matrix-row">
            <div class="matrix-label">Relationship with spouse/partner</div>
            <div class="matrix-options">{{ form.topic_spouse }}</div>
        </div>
        <div class="matrix-row">
            <div class="matrix-label">Relationship with parents/family</div>
            <div class="matrix-options">{{ form.topic_family }}</div>
        </div>
        <div class="matrix-row">
            <div class="matrix-label">Friendships</div>
            <div class="matrix-options">{{ form.topic_friends }}</div>
        </div>
        <div class="matrix-row">
            <div class="matrix-label">Study/Work/Career development</div>
            <div class="matrix-options">{{ form.topic_work }}</div>
        </div>
        <div class="matrix-row">
            <div class="matrix-label">Personal emotions (e.g., anxiety, sadness)</div>
            <div class="matrix-options">{{ form.topic_emotions }}</div>
        </div>
        <div class="matrix-row">
            <div class="matrix-label">Physical health problems</div>
            <div class="matrix-options">{{ form.topic_health }}</div>
        </div>
        <div class="matrix-row">
            <div class="matrix-label">Other</div>
            <div class="matrix-options">{{ form.topic_other_freq }}</div>
        </div>
        <div class="mt-2">
            {{ form.topic_other_text }}
        </div>
    </div>
</div>

<div class="mt-4">
    {{ next_button }}
</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        const section = document.getElementById('conditional-section');
        
        // Inputs
        const companionRadios = document.querySelectorAll('input[name="ai_companion"]');
        const generalRadios = document.querySelectorAll('input[name="ai_general_personal"]');
        
        function checkCondition() {
            let companionYes = false;
            let generalUsed = false;
            
            // Check Q12 (Companion) - Value "Yes"
            for (const radio of companionRadios) {
                if (radio.checked && radio.value === "Yes") {
                    companionYes = true;
                }
            }
            
            // Check Q13 (General) - Any value that is NOT "No"
            // The logic in doc: "Display... ONLY if the answer to Q12 OR Q13 is 'Yes'"
            // Note: Q13 has "No", "Yes, I often...", "Yes, but only rarely..."
            for (const radio of generalRadios) {
                if (radio.checked && radio.value !== "No") {
                    generalUsed = true;
                }
            }
            
            if (companionYes || generalUsed) {
                section.style.display = 'block';
            } else {
                section.style.display = 'none';
            }
        }
        
        // Add listeners
        companionRadios.forEach(radio => radio.addEventListener('change', checkCondition));
        generalRadios.forEach(radio => radio.addEventListener('change', checkCondition));
        
        // Initial check (in case user goes back)
        checkCondition();
    });
</script>

{% endblock %}