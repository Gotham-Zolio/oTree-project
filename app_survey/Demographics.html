{% extends "global/Page.html" %}
{% block title %}Demographics{% endblock %}

{% block content %}
<style>
    /* 基础卡片样式 */
    .question-card {
        background: #fff;
        border: 1px solid #e3e6f0;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.05);
    }
    
    /* 隐藏区域样式 */
    #conditional-section {
        display: none; 
        background-color: #f8f9fa;
        border-left: 5px solid #007bff;
        padding: 20px;
        margin-top: 30px;
        border-radius: 5px;
        animation: fadeIn 0.5s;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    /* --- 量表矩阵样式 --- */
    .likert-table {
        width: 100%;
        text-align: center;
        margin-top: 15px;
        border-collapse: separate; 
        border-spacing: 0;
    }
    
    .likert-table th {
        font-weight: normal;
        padding-bottom: 10px;
        vertical-align: bottom;
        width: 9%;
        color: #555;
        font-size: 0.85rem;
        border-bottom: 2px solid #dee2e6;
    }
    
    .likert-table th.col-question {
        width: 37%;
    }

    .header-num {
        display: block;
        font-size: 1.2rem;
        font-weight: bold;
        color: #333;
        margin-bottom: 2px;
    }
    
    .header-text {
        display: block;
        font-size: 0.75rem;
        line-height: 1.1;
        color: #777;
    }

    .likert-table td {
        padding: 15px 5px;
        border-bottom: 1px solid #eee;
        vertical-align: middle;
    }

    .likert-table td.question-text {
        text-align: left;
        font-weight: 600;
        color: #2c3e50;
    }

    .likert-table tr:hover {
        background-color: #f1f3f5;
    }

    input[type='radio'] {
        transform: scale(1.3);
        cursor: pointer;
    }
    
    .radio-cell {
        cursor: pointer;
    }
    
    .other-input {
        margin-top: 5px;
        font-size: 0.9rem;
        width: 95%;
    }
    
    .clear-btn {
        cursor: pointer;
        color: #adb5bd;
        font-size: 1.2rem;
        padding: 0 10px;
        transition: color 0.2s;
    }
    .clear-btn:hover {
        color: #dc3545;
    }
</style>

<p class="lead">
    For the final part of the study, we would like to collect some basic demographic information for statistical analysis.
    All of your responses will be kept strictly confidential and anonymized.
    This information will not be used to identify you personally. Please answer the following questions.
</p>

<div class="question-card">{{ formfield 'age' }}</div>
<div class="question-card">{{ formfield 'gender' }}</div>
<div class="question-card">{{ formfield 'nationality' }}</div>
<div class="question-card">{{ formfield 'race' }}</div>
<div class="question-card">{{ formfield 'education' }}</div>
<div class="question-card">{{ formfield 'field_of_study' }}</div>
<div class="question-card">{{ formfield 'income' }}</div>
<div class="question-card">{{ formfield 'religion' }}</div>
<div class="question-card">{{ formfield 'marital_status' }}</div>
<div class="question-card">{{ formfield 'ai_use_freq' }}</div>
<div class="question-card">{{ formfield 'ai_attitude' }}</div>

<div class="question-card" id="q_ai_companion">
    {{ formfield 'ai_companion' }}
</div>

<div class="question-card" id="q_ai_general">
    {{ formfield 'ai_general_personal' }}
</div>

<div id="conditional-section">
    <h5 class="mb-3 text-primary">Detailed AI Usage</h5>
    
    <div class="question-card">
        <label class="font-weight-bold mb-2">{{ form.ai_personal_pct.label }}</label>
        <span class="text-muted small mb-3 d-block">(Please exclude functional tasks like writing code, drafting emails, or searching for information. Focus only on the time spent on personal conversation.)</span>
        <div class="input-group" style="max-width: 200px;">
            {{ form.ai_personal_pct }}
            <div class="input-group-append">
                <span class="input-group-text">%</span>
            </div>
        </div>
    </div>

    <div class="question-card">
        <label class="font-weight-bold mb-3">When you use AI for personal topics, how frequently do you discuss each of the following issues?</label>
        
        <table class="likert-table">
            <thead>
                <tr>
                    <th class="col-question"></th>
                    <th><span class="header-num">1</span><span class="header-text">Never</span></th>
                    <th><span class="header-num">2</span><span class="header-text">Very Rarely</span></th>
                    <th><span class="header-num">3</span><span class="header-text">Rarely</span></th>
                    <th><span class="header-num">4</span><span class="header-text">Sometimes</span></th>
                    <th><span class="header-num">5</span><span class="header-text">Often</span></th>
                    <th><span class="header-num">6</span><span class="header-text">Frequently</span></th>
                    <th><span class="header-num">7</span><span class="header-text">Very Freq.</span></th>
                    <th style="width: 30px;"></th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="question-text">Relationship with spouse/partner</td>
                    {% for i in "1234567" %}
                    <td class="radio-cell" onclick="selectRadio('topic_spouse', '{{ i }}')">
                        <input type="radio" name="topic_spouse" value="{{ i }}" required>
                    </td>
                    {% endfor %}
                    <td></td>
                </tr>

                <tr>
                    <td class="question-text">Relationship with parents/family</td>
                    {% for i in "1234567" %}
                    <td class="radio-cell" onclick="selectRadio('topic_family', '{{ i }}')">
                        <input type="radio" name="topic_family" value="{{ i }}" required>
                    </td>
                    {% endfor %}
                    <td></td>
                </tr>

                <tr>
                    <td class="question-text">Friendships</td>
                    {% for i in "1234567" %}
                    <td class="radio-cell" onclick="selectRadio('topic_friends', '{{ i }}')">
                        <input type="radio" name="topic_friends" value="{{ i }}" required>
                    </td>
                    {% endfor %}
                    <td></td>
                </tr>

                <tr>
                    <td class="question-text">Study/Work/Career development</td>
                    {% for i in "1234567" %}
                    <td class="radio-cell" onclick="selectRadio('topic_work', '{{ i }}')">
                        <input type="radio" name="topic_work" value="{{ i }}" required>
                    </td>
                    {% endfor %}
                    <td></td>
                </tr>

                <tr>
                    <td class="question-text">Personal emotions (e.g., anxiety, sadness)</td>
                    {% for i in "1234567" %}
                    <td class="radio-cell" onclick="selectRadio('topic_emotions', '{{ i }}')">
                        <input type="radio" name="topic_emotions" value="{{ i }}" required>
                    </td>
                    {% endfor %}
                    <td></td>
                </tr>

                <tr>
                    <td class="question-text">Physical health problems</td>
                    {% for i in "1234567" %}
                    <td class="radio-cell" onclick="selectRadio('topic_health', '{{ i }}')">
                        <input type="radio" name="topic_health" value="{{ i }}" required>
                    </td>
                    {% endfor %}
                    <td></td>
                </tr>

                <tr>
                    <td class="question-text">
                        Other (Optional):
                        <input type="text" name="topic_other_text" class="form-control form-control-sm other-input" placeholder="Specify topic...">
                    </td>
                    {% for i in "1234567" %}
                    <td class="radio-cell" onclick="selectRadio('topic_other_freq', '{{ i }}')">
                        <input type="radio" name="topic_other_freq" value="{{ i }}">
                    </td>
                    {% endfor %}
                    <td title="Clear selection">
                        <span class="clear-btn" onclick="clearRadioRow('topic_other_freq')">&times;</span>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<div class="mt-4">
    {{ next_button }}
</div>

<script>
    function selectRadio(name, value) {
        const radios = document.getElementsByName(name);
        for (let radio of radios) {
            if (radio.value === value) {
                radio.checked = true;
                break;
            }
        }
    }
    
    function clearRadioRow(name) {
        const radios = document.getElementsByName(name);
        for (let radio of radios) {
            radio.checked = false;
        }
    }

    document.addEventListener("DOMContentLoaded", function() {
        const section = document.getElementById('conditional-section');
        const inputsInHiddenSection = section.querySelectorAll('input, select, textarea');
        
        const companionRadios = document.querySelectorAll('input[name="ai_companion"]');
        const generalRadios = document.querySelectorAll('input[name="ai_general_personal"]');
        
        function checkCondition() {
            let companionYes = false;
            let generalUsed = false;
            
            for (const radio of companionRadios) {
                if (radio.checked && radio.value === "Yes") companionYes = true;
            }
            
            for (const radio of generalRadios) {
                if (radio.checked && radio.value !== "No") generalUsed = true;
            }
            
            if (companionYes || generalUsed) {
                section.style.display = 'block';
                inputsInHiddenSection.forEach(input => {
                    if (input.name !== 'topic_other_freq' && input.name !== 'topic_other_text') {
                        input.required = true;
                    }
                });
            } else {
                section.style.display = 'none';
                inputsInHiddenSection.forEach(input => input.required = false);
            }
        }
        
        companionRadios.forEach(radio => radio.addEventListener('change', checkCondition));
        generalRadios.forEach(radio => radio.addEventListener('change', checkCondition));
        
        checkCondition();
    });
</script>

{% endblock %}